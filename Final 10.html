<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Digital Spare Parts Ecosystem Decision Support Tool (DSP-DST)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Chart.js CDN for results page charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Inter:400,500,600,700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Inter', Arial, sans-serif;
      background: linear-gradient(135deg, #f2f9fd 0%, #e2e6ef 100%);
      color: #1c2230;
      min-height: 100vh;
    }
    .sidebar {
      position: fixed;
      left: 0; top: 0;
      width: 240px;
      height: 100vh;
      background: linear-gradient(135deg, #273e56 30%, #1e2837 100%);
      color: #fff;
      padding-top: 44px;
      box-shadow: 2px 0 14px 0 rgba(40,64,112,0.07);
      z-index: 2;
      transition: width 0.2s;
    }
    .sidebar h2 {
      text-align: center;
      margin-bottom: 32px;
      font-size: 1.75em;
      font-weight: 700;
      letter-spacing: 1px;
      color: #fff;
      text-shadow: 0 1px 9px #1e2837a0;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0 0 18px 0;
    }
    .sidebar ul li {
      padding: 17px 32px;
      cursor: pointer;
      font-size: 1.08em;
      border-radius: 0 24px 24px 0;
      margin-bottom: 6px;
      transition: background 0.22s, color 0.22s, font-weight 0.18s;
      font-weight: 500;
      letter-spacing: 0.01em;
      border-left: 4px solid transparent;
    }
    .sidebar ul li.active, .sidebar ul li:hover {
      background: #e6f3ff15;
      color: #53ccf4;
      border-left: 4px solid #53ccf4;
      font-weight: 600;
    }
    .header {
      margin-left: 240px;
      background: #fff;
      padding: 28px 38px 22px 38px;
      border-bottom: 1px solid #e4ecf5;
      font-size: 1.5em;
      font-weight: 700;
      color: #273e56;
      letter-spacing: 0.01em;
      box-shadow: 0 2px 12px 0 rgba(77,128,185,0.045);
      position: sticky;
      top: 0;
      z-index: 1;
    }
    .main-content {
      margin-left: 240px;
      padding: 48px 32px 40px 32px;
      min-height: 100vh;
      box-sizing: border-box;
      background: transparent;
      transition: margin-left 0.2s;
    }
    .factor-section {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 3px 22px 0 rgba(67, 153, 215, 0.09), 0 0.5px 1.5px #d9e6f3;
      padding: 36px 38px 34px 38px;
      max-width: 750px;
      margin: 56px auto 0 auto;
      text-align: left;
      border: 1.5px solid #e2edf7;
      position: relative;
    }
    .factor-title {
      font-size: 1.35em;
      font-weight: 600;
      margin-bottom: 15px;
      color: #1665c1;
      letter-spacing: 0.01em;
    }
    .indicator-block, .criteria-block {
      margin-bottom: 22px;
    }
    .indicator-label, .criteria-label {
      margin-bottom: 7px;
      color: #273e56;
      font-weight: 500;
      letter-spacing: 0.01em;
    }
    .rating-group label {
      margin-right: 15px;
      font-weight: 400;
      color: #1c2230;
      padding: 6px 10px 5px 6px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.14s;
    }
    .rating-group input[type="radio"] {
      accent-color: #53ccf4;
      margin-right: 4px;
      vertical-align: middle;
    }
    .rating-group label:hover {
      background: #e4f5ff;
    }
    .average-score, .criteria-average {
      font-weight: 600;
      color: #21a179;
      margin-top: 12px;
      letter-spacing: 0.01em;
    }
    .weighted-score {
      font-weight: 600;
      color: #f59e42;
      margin-top: 6px;
      letter-spacing: 0.01em;
    }
    .directrel-score {
      font-weight: 600;
      color: #2046c7;
      margin-top: 7px;
      letter-spacing: 0.01em;
    }
    .indirectrel-score {
      font-weight: 600;
      color: #cc2c2c;
      margin-top: 7px;
      letter-spacing: 0.01em;
    }
    .final-readiness-score {
      font-weight: bold;
      color: #005b99;
      margin-top: 7px;
      letter-spacing: 0.01em;
    }
    .percent-score {
      font-weight: bold;
      color: #19bf7a;
      margin-top: 7px;
      letter-spacing: 0.01em;
    }
 .strategic-action-block {
  margin-top: 32px;
  margin-bottom: 18px;
  background: linear-gradient(90deg, #fffbe7 80%, #ffeab6 100%);
  border-left: 7px solid #f5b942;
  border-radius: 10px;
  box-shadow: 0 3px 14px #ffe3a1a8;
  padding: 26px 32px 24px 28px;
  display: flex;
  align-items: flex-start;
  gap: 18px;
  animation: pulse-glow 1.2s 1;
}
@keyframes pulse-glow {
  0%   { box-shadow: 0 0 0 0 #ffeab6; }
  60%  { box-shadow: 0 0 14px 8px #ffeab6; }
  100% { box-shadow: 0 3px 14px #ffe3a1a8; }
}
.strategic-action-icon {
  font-size: 2.1em;
  color: #f5b942;
  margin-top: 3px;
  flex-shrink: 0;
  filter: drop-shadow(0 2px 4px #ffd66b44);
}
.strategic-action-content {
  flex: 1 1 auto;
}
.strategic-action-title {
  font-weight: 700;
  color: #ab7d00;
  font-size: 1.1em;
  margin-bottom: 5px;
  letter-spacing: 0.02em;
  display: flex;
  align-items: center;
  gap: 10px;
}
.important-badge {
  background: linear-gradient(90deg, #ffe48c 60%, #f5b942 100%);
  color: #7a5a00;
  border-radius: 14px;
  font-weight: bold;
  font-size: 0.92em;
  padding: 3px 13px;
  margin-left: 9px;
  letter-spacing: 0.05em;
  box-shadow: 0 1px 4px #ffeab622;
}
.strategic-action-desc {
  color: #b38816;
  margin-bottom: 7px;
  font-size: 1em;
}
    .survey-nav {
      text-align: center;
      margin-top: 34px;
    }
    .nav-btn {
      padding: 11px 38px;
      border: none;
      border-radius: 6px;
      background: linear-gradient(90deg, #53ccf4 60%, #1665c1 100%);
      color: #fff;
      font-size: 1.07em;
      font-weight: 600;
      cursor: pointer;
      margin: 0 11px;
      box-shadow: 0 2px 10px 0 rgba(67, 153, 215, 0.13);
      letter-spacing: 0.01em;
      transition: background 0.16s, box-shadow 0.13s;
    }
    .nav-btn:disabled {
      background: #cfeaf7;
      color: #b5b9be;
      cursor: not-allowed;
      box-shadow: none;
    }
    .nav-btn:hover:enabled {
      background: linear-gradient(90deg, #1665c1 50%, #53ccf4 100%);
      color: #fff;
      box-shadow: 0 4px 16px 0 rgba(67, 153, 215, 0.18);
    }
    .progress-bar-container {
      background: #e9f6fa;
      border-radius: 7px;
      height: 22px;
      width: 100%;
      max-width: 750px;
      margin: 0 auto 38px auto;
      overflow: hidden;
      box-shadow: 0 1px 4px 0 #c6e9f8;
      border: 1px solid #dbeffd;
    }
.progress-bar {
  background: #fff; /* White background */
  color: #1665c1;   /* Blue text for visibility */
  font-size: 1.11em;
  text-align: center;
  line-height: 22px;
  font-weight: 700;
  letter-spacing: 0.01em;
  border-radius: 7px 0 0 7px;
  box-shadow: 0 1px 2px #b0e3fb inset;
  border: 1.5px solid #53ccf4; /* Optional: blue border */
}
    }

    /* --- Responsive --- */
    @media (max-width: 900px) {
      .sidebar, .header, .main-content {
        margin-left: 0 !important;
      }
      .sidebar {
        position: static;
        width: 100%;
        height: auto;
        box-shadow: none;
        border-radius: 0 0 14px 14px;
        padding-top: 16px;
      }
      .header {
        padding: 28px 14px 18px 14px;
        font-size: 1.19em;
      }
      .main-content {
        padding: 22px 2vw 30px 2vw;
      }
      .factor-section, .settings-section, .results-section {
        padding: 18px 7vw 16px 7vw;
        margin-top: 20px;
      }
      .progress-bar-container {
        max-width: 100%;
      }
    }
    @media (max-width: 600px) {
      .factor-section, .settings-section, .results-section {
        padding: 10px 2vw 10px 2vw;
        margin-top: 10px;
      }
      .sidebar h2 { font-size: 1.1em;}
      .sidebar ul li { padding: 10px 13px;}
    }

    .settings-section {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 3px 22px 0 rgba(67, 153, 215, 0.07), 0 0.5px 1.5px #d9e6f3;
      padding: 32px 36px 30px 36px;
      max-width: 600px;
      margin: 56px auto 0 auto;
      text-align: left;
      color: #1c2230;
      border: 1.5px solid #e2edf7;
    }

    /* --- New for results --- */
    .results-section {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 18px rgba(34,46,60,0.12), 0 0.5px 1.5px #d9e6f3;
      padding: 36px 28px 34px 28px;
      max-width: 1200px;
      margin: 50px auto 0 auto;
      text-align: center;
      position: relative;
      border: 1.5px solid #e2edf7;
    }
    .chart-wrapper {
      max-width: 540px;
      margin: 40px auto 25px auto;
      background: #f3f9fd;
      border-radius: 11px;
      padding: 14px 8px;
      box-shadow: 0 2.5px 9px #dbeffd70;
    }
    .bar-chart-wrapper {
      max-width: 840px;
      margin: 0 auto 34px auto;
      background: #f3f9fd;
      border-radius: 11px;
      padding: 14px 8px;
      box-shadow: 0 2.5px 9px #dbeffd60;
    }
    .toggle-table-btn {
      padding: 10px 26px;
      border: none;
      border-radius: 6px;
      background: #fff;
      color: #1665c1;
      font-size: 1.07em;
      font-weight: 700;
      border: 2px solid #1665c1;
      margin: 0 7px;
      cursor: pointer;
      box-shadow: 0 1px 3px #e7f4ff;
      transition: background 0.14s, color 0.19s, border 0.13s;
    }
    .toggle-table-btn:hover {
      background: #1665c1;
      color: #fff;
      border: 2px solid #53ccf4;
    }
    .results-table {
      border-collapse: separate;
      border-spacing: 0;
      margin: 20px auto 0 auto;
      width: 100%;
      max-width: 1030px;
      font-size: 1.04em;
      background: #f7fcff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 14px rgba(34,46,60,0.09);
      display: none;
      transition: display 0.2s;
    }
    .results-table.visible {
      display: table;
    }
    .results-table th, .results-table td {
      border: 1.5px solid #bbe1fa;
      padding: 10px 8px;
      text-align: center;
    }
    .results-table th {
      background: linear-gradient(90deg,#e0f4ff 80%,#f8fdff 100%);
      color: #1665c1;
      font-weight: 700;
      letter-spacing: 0.01em;
    }
    .results-table td.final-readiness-score { background:#e0f4ff; }
    .results-table td.percent-score { background:#eaffea; }
    /* Add smooth transitions to error/info blocks */
    .factor-section, .results-section, .settings-section {
      transition: box-shadow 0.2s, border 0.22s;
    }
    /* Minor style for ul in welcome section */
    .factor-section ul {
      margin: 0 0 22px 20px;
      padding: 0;
      color: #294360;
      font-size: 1.04em;
    }
    .factor-section ul li {
      margin-bottom: 5px;
      letter-spacing: 0.01em;
    }
    /* Welcome page main title */
    .factor-section .factor-title {
      font-size: 2.1em;
      color: #1665c1;
      letter-spacing: 0.01em;
      margin-bottom: 10px;
      font-weight: 700;
    }
    .factor-section h2, .results-section h2, .settings-section h2 {
      color: #1665c1;
      font-size: 1.5em;
      font-weight: 700;
      margin-bottom: 18px;
      letter-spacing: 0.01em;
    }
    /* Minor effect for info blocks */
    .factor-section > div, .results-section > div, .settings-section > div {
      transition: color 0.14s;
    }
.rec-card {
  background: #fff;
  border-radius: 11px;
  box-shadow: 0 2px 10px #dbeffd44;
  padding: 18px 22px 15px 22px;
  margin-bottom: 20px;
  border-left: 5px solid #2477d6;
  display: flex;
  align-items: flex-start;
  gap: 18px;
  transition: box-shadow 0.18s;
}
.rec-card .rec-step {
  min-width: 36px;
  min-height: 36px;
  background: #2477d6;
  color: #fff;
  font-weight: bold;
  font-size: 1.18em;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-top: 2px;
  box-shadow: 0 1px 3px #b2d8fd44;
}
.rec-card.rec-long { border-left-color: #21a179; }
.rec-card.rec-accl { border-left-color: #e6841b; }
.rec-title {
  font-size: 1.09em;
  font-weight: 600;
  margin: 8px 0 12px 0;
  color: #1665c1;
  letter-spacing: 0.01em;
  display: flex;
  align-items: center;
  gap: 8px;
}
details.rec-card {
  padding: 0;
  background: none;
  border: none;
  box-shadow: none;
  margin-bottom: 20px;
}
details.rec-card summary {
  font-size: 1.09em;
  font-weight: 600;
  color: #e6841b;
  cursor: pointer;
  margin-bottom: 8px;
}

.factor-score-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: #f7fbfe;
  border: 1.3px solid #e2edf7;
  border-radius: 16px;
  padding: 18px 32px;
  margin-bottom: 26px;
  min-height: 56px;
  box-sizing: border-box;
  font-size: 1.16em;
  box-shadow: 0 1px 6px #ddefff33;
}
.factor-score-label {
  font-weight: 700;
  color: #2058b0;
  letter-spacing: 0.01em;
  text-align: left;
  flex: 1 1 auto;
  margin-right: 20px;
}
.factor-score-badge {
  font-weight: 600;
  font-size: 1em;
  border-radius: 22px;
  padding: 7px 28px 7px 22px;
  color: #fff;
  background: #21a179;
  display: inline-block;
  min-width: 85px;
  text-align: center;
  box-shadow: 0 1px 5px #0001;
  margin-left: 12px;
}
.factor-score-badge.low   { background: #e74c3c; }
.factor-score-badge.medium{ background: #e6b800; color: #444; }
.factor-score-badge.high  { background: #21a179; }
@media (max-width: 700px) {
  .factor-score-row {
    flex-direction: column;
    align-items: stretch;
    padding: 14px 10px;
    font-size: 1em;
  }
  .factor-score-label {
    margin-bottom: 10px;
    margin-right: 0;
  }
  .factor-score-badge {
    margin-left: 0;
    align-self: flex-start;
  }
}
/* Mobile-friendly results table and charts */
.results-table-wrapper {
  overflow-x: auto;
  width: 100%;
}
.results-table {
  min-width: 600px;
  width: 100%;
}
.chart-wrapper, .bar-chart-wrapper {
  max-width: 100vw;
  min-width: 0;
}
canvas {
  width: 100% !important;
  height: auto !important;
  max-width: 100vw;
}
.chart-toggle-group {
  text-align: center;
  margin-bottom: 14px;
}
.chart-toggle-btn {
  padding: 8px 22px;
  border: none;
  border-radius: 6px;
  background: #e4f5ff;
  color: #1665c1;
  font-size: 1em;
  font-weight: 600;
  margin: 0 5px 5px 0;
  cursor: pointer;
  border: 2px solid #53ccf4;
  transition: background 0.13s, color 0.13s, border 0.13s;
}
.chart-toggle-btn.selected,
.chart-toggle-btn:focus {
  background: #53ccf4;
  color: #fff;
  border: 2px solid #1665c1;
  outline: none;
}
#avgScore,
#weightedScore,
#criteriaAvg,
#directRelScore {
  display: none !important;
}
/* --- Survey Section Card --- */
.survey-section-card {
  background: #f9fbfe;
  border-radius: 16px;
  box-shadow: 0 2.5px 16px #e7f4ff90;
  padding: 28px 30px 20px 30px;
  margin-bottom: 32px;
  border-left: 7px solid #53ccf4;
  animation: fadeInUp 0.6s;
}
@keyframes fadeInUp {
  0% { opacity: 0; transform: translateY(40px);}
  100% { opacity: 1; transform: none;}
}
.survey-section-header {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 16px;
}
.survey-section-step {
  background: linear-gradient(90deg,#e4f5ff 60%,#53ccf4 100%);
  color: #1665c1;
  font-weight: 600;
  border-radius: 16px;
  padding: 5px 18px;
  font-size: 1em;
  letter-spacing: 0.04em;
  box-shadow: 0 1px 4px #bdf3fd33;
}
.survey-section-title {
  font-size: 1.25em;
  font-weight: 700;
  color: #2058b0;
  letter-spacing: 0.02em;
  flex: 1 1 auto;
}
.survey-section-icon {
  font-size: 1.4em;
  color: #53ccf4;
  filter: drop-shadow(0 1px 2px #bdf3fd44);
}

/* --- Modern Radio Buttons --- */
.rating-group {
  display: flex;
  gap: 13px;
  margin-bottom: 8px;
  margin-top: 4px;
}
.rating-radio {
  display: none;
}
.rating-label {
  display: inline-block;
  padding: 12px 0 10px 0;
  width: 48px;
  border-radius: 50%;
  font-size: 1.17em;
  font-weight: 600;
  background: #e4f5ff;
  color: #1665c1;
  text-align: center;
  box-shadow: 0 0.5px 4px #bdf3fd33;
  border: 2px solid #e4f5ff;
  cursor: pointer;
  transition: background 0.16s, color 0.16s, border 0.16s, transform 0.11s;
  user-select: none;
}
.rating-radio:checked + .rating-label,
.rating-label.selected {
  background: linear-gradient(90deg, #53ccf4 60%, #1665c1 100%);
  color: #fff;
  border-color: #53ccf4;
  transform: scale(1.08);
  box-shadow: 0 2px 10px #53ccf466;
}
.rating-label:hover, .rating-label:focus {
  border-color: #53ccf4;
  outline: none;
}

/* --- Progress Bar --- */
.progress-bar-container {
  background: #e9f6fa;
  border-radius: 7px;
  height: 38px;
  width: 100%;
  max-width: 750px;
  margin: 0 auto 38px auto;
  overflow: hidden;
  box-shadow: 0 1px 4px 0 #c6e9f8;
  border: 1px solid #dbeffd;
  position: relative;
}
.progress-bar-bg {
  width: 100%;
  height: 100%;
  position: relative;
  background: #fff;
  border-radius: 7px;
}
.progress-bar-fill {
  background: linear-gradient(90deg,#53ccf4 60%,#1665c1 100%);
  height: 100%;
  border-radius: 7px 0 0 7px;
  transition: width 0.35s;
  position: absolute;
  left: 0; top: 0; bottom: 0;
  z-index: 1;
}
.progress-bar-label {
  position: absolute;
  top: 0; left: 0; width: 100%; height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 1.15em;
  color: #1665c1; /* blue text ALWAYS */
  z-index: 2;
  pointer-events: none;
  letter-spacing: 0.01em;
}

/* --- Responsive --- */
@media (max-width: 700px) {
  .survey-section-card { padding: 16px 5vw; }
  .survey-section-title { font-size: 1.07em; }
  .survey-section-step { font-size: 0.96em; padding: 4px 12px;}
  .rating-label { width: 40px; font-size: 1em; padding: 9px 0 7px 0;}
  .progress-bar-container { max-width: 98vw; }


}
.welcome-hero {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 40px;
  padding: 46px 44px 36px 44px;
  border-radius: 22px;
  background: linear-gradient(100deg, #eaf8ff 70%, #f4f0ff 100%);
  box-shadow: 0 3px 32px #53ccf422;
  margin-bottom: 36px;
}
.hero-text {
  flex: 1 1 400px;
}
.hero-title {
  font-size: 2.1em;
  font-weight: 800;
  color: #1665c1;
  margin-bottom: 10px;
  line-height: 1.2;
}
.dspdst-acronym {
  color: #53ccf4;
  font-size: 0.8em;
  font-weight: 700;
}
.hero-tagline {
  font-size: 1.14em;
  color: #1e3e6f;
  margin-bottom: 18px;
  font-weight: 500;
}
.hero-benefit {
  font-size: 1.07em;
  color: #2477d6;
  margin-bottom: 26px;
  line-height: 1.6;
}
.hero-btn {
  font-size: 1.2em;
  padding: 13px 42px;
  border-radius: 7px;
  background: linear-gradient(90deg, #53ccf4 60%, #1665c1 100%);
  box-shadow: 0 4px 18px #53ccf455;
}
.hero-graphic {
  flex: 0 0 240px;
}
.how-it-works {
  display: flex;
  justify-content: center;
  gap: 34px;
  margin-top: 18px;
  margin-bottom: 10px;
}
.step {
  text-align: center;
  background: #fff;
  border-radius: 13px;
  padding: 18px 24px 13px 24px;
  box-shadow: 0 1.5px 10px #53ccf433;
  min-width: 130px;
}
.step-icon {
  font-size: 2.1em;
  margin-bottom: 8px;
}
.step-title {
  font-size: 1.05em;
  font-weight: 700;
  color: #1665c1;
  margin-bottom: 3px;
}
@media (max-width: 900px) {
  .welcome-hero { flex-direction: column; padding: 28px 8vw 20px 8vw; }
  .hero-graphic { margin-top: 14px; }
  .how-it-works { flex-direction: column; align-items: center; gap:20px;}
}
.progress-steps-bar {
  display: flex;
  justify-content: center;
  margin-bottom: 14px;
  gap: 6px;
}
.progress-step {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: #e6f1fd;
  color: #1665c1;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  cursor: pointer;
  border: 2px solid #e6f1fd;
  transition: background 0.2s, border 0.2s;
  outline: none;
  user-select: none;
}
.progress-step.completed {
  background: #53ccf4;
  color: #fff;
  border: 2px solid #1665c1;
}
.progress-step.current {
  background: #1665c1;
  color: #fff;
  border: 2px solid #1665c1;
}
.progress-step:not(.completed):not(.current) {
  cursor: default;
  opacity: 0.6;
}
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>Dashboard</h2>
<ul>
  <li id="sidebar-home" class="active" onclick="navigate('home')">Main page</li>
  <li id="sidebar-survey" onclick="navigate('survey')">Assessment</li>
  <li id="sidebar-results" onclick="navigate('results')">Readiness Insights</li>
  <li id="sidebar-recommendations" onclick="navigate('recommendations')">Action Plan</li>
</ul>
  </div>
  <div class="header" id="mainHeader"></div>
  <div class="main-content" id="mainContent">
    <!-- Content is rendered here -->
  </div>
  <script>
    // Factor list
    const factors = [
      "Technological Compatibility", "Material Availability & Performance", "Infrastructure Requirements",
      "Cost", "Scalability", "Quality Assurance", "Regulatory Compliance", "Industry Readiness",
      "Customization Needs", "Sustainability", "Risk Management", "Vendor Support", "Collaboration & Partnerships"
    ];
    // Criteria
    const criteriaLabels = [
      "Alignment with National Goals",
      "Impact on Industry Adoption",
      "Contribution to Economic Growth",
      "Organizational Readiness",
      "Ease of Implementation"
    ];
    // Ecosystem Plan Data for Recommendations Page
    const ecosystemPlan = {
  "Technological Compatibility": {
    shortTerm: [
      "Establish cross-functional DSP compliance team",
      "Conduct enterprise-wide digital infrastructure mapping",
      "Initiate pilot programs aligned with national DSP APIs"
    ],
    longTerm: [
      "Embed DSP standards into enterprise architecture governance",
      "Create real-time decision systems for DSP-data integration",
      "Take lead in national interoperability testing programs"
    ],
    acceleration: [
      "Provide pre-configured integration templates and system toolkits",
      "Create structured onboarding tracks with dedicated support",
      "Recognize compliance milestones internally to drive engagement"
    ]
  },
  "Material Availability & Performance": {
    shortTerm: [
      "Collaborate with national material hub for pre-validation consultations",
      "Establish internal material audit process",
      "Launch pilot tests with high-usage materials"
    ],
    longTerm: [
      "Establish a cross-departmental material strategy group",
      "Build internal labs to co-develop sustainable materials",
      "Develop proprietary material testing protocols aligned with national standards"
    ],
    acceleration: [
      "Facilitate rapid material validation cycles with shared infrastructure",
      "Offer R&D partnership incentives for aligned material needs",
      "Run pilot schemes to de-risk early certified material use"
    ]
  },
  "Infrastructure Requirements": {
    shortTerm: [
      "Create DSP infrastructure roadmap across IT, logistics, and warehousing",
      "Conduct readiness workshops with internal stakeholders",
      "Initiate vendor consultations for targeted upgrades"
    ],
    longTerm: [
      "Fully automate DSP logistics across supply, storage, and inventory",
      "Implement predictive analytics for DSP demand planning",
      "Join national smart infrastructure steering committees"
    ],
    acceleration: [
      "Develop modular infrastructure upgrade roadmaps with clear milestones",
      "Deploy cross-functional task forces for phased implementation",
      "Prioritize upgrades that unlock scalable workflows"
    ]
  },
  "Risk Management": {
    shortTerm: [
      "Formulate comprehensive DSP risk register",
      "Align cybersecurity roadmap with DSP risk protocols",
      "Deploy internal awareness campaigns and simulation drills"
    ],
    longTerm: [
      "Operationalize a DSP-specific enterprise risk management layer",
      "Develop AI-driven DSP threat detection systems",
      "Publish annual DSP risk audits for board-level review"
    ],
    acceleration: [
      "Embed DSP risks into enterprise risk management frameworks",
      "Deliver targeted training on cybersecurity and IP policies",
      "Utilize automated compliance monitoring tools"
    ]
  },
  "Cost": {
    shortTerm: [
      "Create internal task force for incentive identification and ROI modeling",
      "Design phased investment proposal",
      "Launch cross-functional pilot projects tied to financial KPIs"
    ],
    longTerm: [
      "Institutionalize a DSP innovation fund",
      "Embed DSP targets into long-term strategic planning",
      "Offer internal grants for departmental DSP acceleration"
    ],
    acceleration: [
      "Launch targeted incentive calls aligned with DSP initiatives",
      "Support ROI modeling and early business case formation",
      "Leverage cross-financing mechanisms for DSP investment"
    ]
  },
  "Scalability": {
    shortTerm: [
      "Establish interim production partnerships with leading DSP clusters",
      "Define operational performance indicators",
      "Execute joint learning projects with external vendors"
    ],
    longTerm: [
      "Transition from outsourced clusters to hybrid in-house printing capacity",
      "Establish continuous process improvement teams",
      "Implement factory digital twins for scalable optimization"
    ],
    acceleration: [
      "Initiate service agreements with shared manufacturing hubs",
      "Implement phased insourcing strategy informed by demand",
      "Set up dedicated review cycles to refine scaling trajectory"
    ]
  },
  "Quality Assurance": {
    shortTerm: [
      "Build internal QA testbeds aligned with national standards",
      "Deploy blockchain or token-based traceability tech in pilot products",
      "Align QA metrics with product lifecycle goals"
    ],
    longTerm: [
      "Establish DSP QA certification center within the organization",
      "Mandate traceability standards across all product lines",
      "Act as a sector QA ambassador in national taskforces"
    ],
    acceleration: [
      "Integrate traceability tools into QA workflows via pilot programs",
      "Incentivize documentation of QA best practices",
      "Build internal champions for digital QA processes"
    ]
  },
  "Vendor Support": {
    shortTerm: [
      "Formalize vendor assessment frameworks using DSP criteria",
      "Engage in bilateral reviews with high-potential suppliers",
      "Initiate DSP-compliant procurement simulations"
    ],
    longTerm: [
      "Create DSP vendor innovation labs",
      "Develop long-term co-investment strategies",
      "Institutionalize supplier evaluation scorecards across product lines"
    ],
    acceleration: [
      "Offer access to verified supplier registries and onboarding platforms",
      "Promote multi-vendor sourcing frameworks",
      "Align procurement guidelines with performance benchmarks"
    ]
  },
  "Regulatory Compliance": {
    shortTerm: [
      "Set up legal-technical review board for sandbox entry",
      "Define internal hypothesis for regulatory experimentation",
      "Deploy agile compliance modeling tools"
    ],
    longTerm: [
      "Integrate sandbox protocols into permanent governance structures",
      "Chair multi-sector regulatory feedback forums",
      "Publish open-access compliance insights to guide policy"
    ],
    acceleration: [
      "Participate in controlled environments to test compliance scenarios",
      "Designate internal leads for iterative feedback loops",
      "Incorporate learnings into formal governance models"
    ]
  },
  "Industry Readiness": {
    shortTerm: [
      "Integrate DSP KPIs into quarterly business reviews",
      "Conduct maturity benchmarking across business units",
      "Use readiness insights to update strategic targets"
    ],
    longTerm: [
      "Lead sectoral DSP readiness benchmarking annually",
      "Influence industry-level DSP standard setting",
      "Embed DSP metrics into corporate ESG and digital maturity reports"
    ],
    acceleration: [
      "Use diagnostic tools to measure functional readiness",
      "Establish internal benchmarking dashboards",
      "Incentivize departments to improve adoption scores over time"
    ]
  },
  "Customization Needs": {
    shortTerm: [
      "Audit current product designs for modularity potential",
      "Train engineering teams on modular compliance",
      "Develop pilot modular product lines with ROI tracking"
    ],
    longTerm: [
      "Mandate modular design gates in all product development cycles",
      "Institutionalize training programs on modular thinking",
      "Publish modular design benchmarks for industry use"
    ],
    acceleration: [
      "Provide modular design training and certification support",
      "Reward modularity-based efficiency gains",
      "Integrate reusability metrics into product development KPIs"
    ]
  },
  "Sustainability": {
    shortTerm: [
      "Define closed-loop workflows for two key product categories",
      "Launch internal education on circular design",
      "Align supply chain to include reuse channels"
    ],
    longTerm: [
      "Embed circularity into core value proposition",
      "Report DSP-driven sustainability gains to national dashboards",
      "Launch branded reuse programs tied to customer engagement"
    ],
    acceleration: [
      "Support lifecycle tracking through digital audit tools",
      "Incentivize closed-loop pilots across operations",
      "Reward initiatives that reduce material footprint"
    ]
  },
  "Collaboration & Partnerships": {
    shortTerm: [
      "Deploy open innovation platform internally to collect staff ideas",
      "Organize quarterly DSP hackathons with partners",
      "Launch exploratory co-creation sprints"
    ],
    longTerm: [
      "Scale successful pilots into fully-funded cross-sector platforms",
      "Lead public-private DSP consortia",
      "Influence national roadmaps via ecosystem foresight units"
    ],
    acceleration: [
      "Match internal innovation efforts with external R&D partners",
      "Allocate funding pools for co-development pilots",
      "Formalize joint innovation governance structures"
    ]
  }
};
    // Survey data (copied from previous answers)
    const surveyData = [
      { factor: "Technological Compatibility", weight: 0.31287, indicators: [
          "Multi-process integration capability is important for shaping or enabling a successful DSP ecosystem in your industry.",
          "System interoperability with existing digital infrastructure is crucial for DSP adoption in your industry.",
          "Adaptive precision and monitoring functionality are essential for DSP technologies to operate effectively in your industry."
        ], strategicAction: "Adopt certified DSP platforms and align internal systems to national interoperability standards."
      },
      { factor: "Material Availability & Performance", weight: -0.15459, indicators: [
          "Availability of materials is a critical factor for enabling DSP adoption in your industry.",
          "Material compatibility with operational conditions is essential for the reliable performance of DSP in your industry.",
          "The consistency of local access and certification of validated materials are important for ensuring effective DSP deployment in your industry."
        ], strategicAction: "Engage with the national material hub to validate and certify materials used in in-house production."
      },
      { factor: "Infrastructure Requirements", weight: 0.30076, indicators: [
          "Data interoperability readiness is important for facilitating DSP adoption in your industry.",
          "Software-hardware compatibility is essential for integrating DSP systems into your industry‚Äôs infrastructure.",
          "Workflow integration capability is necessary for the success of DSP in your industry."
        ], strategicAction: "Conduct internal infrastructure audits and align IT, logistics, and storage systems with DSP readiness guidelines."
      },
      { factor: "Cost", weight: 0.35329, indicators: [
          "The affordability of DSP technologies is a key factor in your industry's ability to adopt DSP solutions.",
          "Cost optimization and lifecycle planning are crucial for ensuring the long-term success of DSP in your industry.",
          "Aligning cost models with the specific needs of your industry is important for DSP adoption."
        ], strategicAction: "Integrate DSP risk governance protocols into internal operations, covering data, cybersecurity, and IP management."
      },
      { factor: "Scalability", weight: -0.13809, indicators: [
          "The flexibility of production systems is important for scaling DSP technologies in your industry.",
          "The integration of scalable processes into existing supply chains is important for enabling DSP growth in your industry.",
          "Maintaining consistency in quality across scaled operations is essential for the success of DSP in your industry."
        ], strategicAction: "Utilize available national incentives and develop internal DSP business cases for early-stage investment."
      },
      { factor: "Quality Assurance", weight: 0.32519, indicators: [
          "Consistency in material and part integrity is crucial for ensuring the quality of 3D-printed spare parts in your industry.",
          "The adoption of real-time monitoring and defect correction is essential for maintaining the quality of DSP in your industry.",
          "Compliance with industry-wide quality standards is necessary for the successful implementation of DSP in your industry."
        ], strategicAction: "Leverage centralized 3D printing clusters while building phased in-house capabilities to support future scalability."
      },
      { factor: "Regulatory Compliance", weight: 0.31156, indicators: [
          "Compliance with standards and certification is a fundamental requirement for DSP technologies in your industry.",
          "Regulatory quality and reliability management is important for maintaining the integrity of DSP in your industry.",
          "Conformity to international regulatory frameworks is critical for DSP adoption in your industry."
        ], strategicAction: "Implement internal QA workflows that comply with national DSP quality protocols, including digital traceability tools."
      },
      { factor: "Industry Readiness", weight: -0.20426, indicators: [
          "Technological and infrastructure readiness is a critical factor for DSP adoption in your industry.",
          "Workforce and organizational readiness is essential for enabling DSP solutions in your industry.",
          "Investment in innovation is needed for advancing DSP adoption in your industry."
        ], strategicAction: "Register with the national vendor onboarding system and diversify DSP supplier engagement based on compliance metrics."
      },
      { factor: "Customization Needs", weight: 0.41602, indicators: [
          "Industry-specific design requirements are essential for DSP adoption in your industry.",
          "Integration with digital technologies is crucial for facilitating part customization in your industry.",
          "DSP's impact on supply chain flexibility is important for meeting customization demands in your industry."
        ], strategicAction: "Participate in regulatory sandboxes and update internal compliance policies based on real-time learnings."
      },
      { factor: "Sustainability", weight: 0, indicators: [
          "Material efficiency and waste reduction are important for a sustainable DSP ecosystem in your industry.",
          "Lifecycle extension through repair/remanufacturing is necessary for sustainability in DSP adoption in your industry.",
          "Localized production to reduce supply chain impact is important for sustainable DSP systems in your industry."
        ], strategicAction: "Use industry-specific DSP readiness kits to benchmark current capabilities and plan targeted adoption roadmaps."
      },
      { factor: "Risk Management", weight: 0, indicators: [
          "The adoption of structured risk management frameworks is essential for mitigating risks related to DSP in your industry.",
          "Implementing cybersecurity protocols to protect DSP data is important for secure adoption in your industry.",
          "Operational preparedness to mitigate supply chain disruption risks is necessary for successful DSP implementation in your industry."
        ], strategicAction: "Adopt modular design principles and integrate them into product development workflows for customized spare parts."
      },
      { factor: "Vendor Support", weight: 0.33143, indicators: [
          "Vendors providing reliable after-sales service and technical assistance is crucial for the success of DSP in your industry.",
          "Long-term vendor partnerships for hardware and software maintenance are essential for the sustainability of DSP in your industry.",
          "Assessing and mitigating vendor lock-in risks is important for flexibility in DSP solutions in your industry."
        ], strategicAction: "Embed circular design and lifecycle tracking into DSP operations to align with national sustainability mandates."
      },
      { factor: "Collaboration & Partnerships", weight: 0.21967, indicators: [
          "Stakeholder collaboration in DSP ecosystem design and implementation is crucial for the success of DSP in your industry.",
          "The joint development of standardized practices and data-sharing mechanisms is important for enabling DSP in your industry.",
          "Engagement in cross-functional innovation and ecosystem standardization efforts is essential for successful DSP adoption in your industry."
        ], strategicAction: "Join the national innovation platform and initiate co-development projects with ecosystem partners."
      }

    ];
    // Relationships (copied from previous answer)
    const relationships = {
      "Technological Compatibility": {
        "Material Availability & Performance": { R: 0.49852, S: 1 },
        "Infrastructure Requirements": { R: 0.11587, S: 0 },
        "Cost": { R: 0.60252, S: 1 },
        "Scalability": { R: 0.01287, S: 0 },
        "Quality Assurance": { R: 0.28893, S: 1 },
        "Regulatory Compliance": { R: 0.62855, S: 1 },
        "Industry Readiness": { R: 0.03182, S: 0 },
        "Customization Needs": { R: 0.2333, S: 1 },
        "Sustainability": { R: 0.29628, S: 1 },
        "Risk Management": { R: 0.52845, S: 1 },
        "Vendor Support": { R: 0.03081, S: 0 },
        "Collaboration & Partnerships": { R: 0.03559, S: 0 }
      },
      "Material Availability & Performance": {
        "Infrastructure Requirements": { R: -0.02168, S: 0 },
        "Cost": { R: 0.09163, S: 0 },
        "Scalability": { R: 0.45181, S: 1 },
        "Quality Assurance": { R: -0.05366, S: 0 },
        "Regulatory Compliance": { R: -0.0568, S: 0 },
        "Industry Readiness": { R: -0.01447, S: 0 },
        "Customization Needs": { R: 0.02477, S: 0 },
        "Sustainability": { R: 0.10376, S: 0 },
        "Risk Management": { R: 0.50387, S: 1 },
        "Vendor Support": { R: -0.04518, S: 0 },
        "Collaboration & Partnerships": { R: 0.0206, S: 0 }
      },
      "Infrastructure Requirements": {
        "Cost": { R: 0.04647, S: 0 },
        "Scalability": { R: 0.07232, S: 0 },
        "Quality Assurance": { R: 0.18573, S: 1 },
        "Regulatory Compliance": { R: 0.2226, S: 1 },
        "Industry Readiness": { R: 0.5857, S: 1 },
        "Customization Needs": { R: -0.02704, S: 0 },
        "Sustainability": { R: -0.00202, S: 0 },
        "Risk Management": { R: 0.00409, S: 0 },
        "Vendor Support": { R: 0.02571, S: 0 },
        "Collaboration & Partnerships": { R: 0.18407, S: 1 }
      },
      "Cost": {
        "Scalability": { R: 0.1536, S: 0 },
        "Quality Assurance": { R: 0.19218, S: 1 },
        "Regulatory Compliance": { R: 0.49416, S: 1 },
        "Industry Readiness": { R: -0.0592, S: 0 },
        "Customization Needs": { R: 0.08761, S: 0 },
        "Sustainability": { R: 0.05168, S: 0 },
        "Risk Management": { R: 0.02265, S: 0 },
        "Vendor Support": { R: 0.15958, S: 1 },
        "Collaboration & Partnerships": { R: 0.05853, S: 0 }
      },
      "Scalability": {
        "Quality Assurance": { R: 0.14371, S: 0 },
        "Regulatory Compliance": { R: 0.09595, S: 0 },
        "Industry Readiness": { R: 0.48759, S: 1 },
        "Customization Needs": { R: -0.00151, S: 0 },
        "Sustainability": { R: 0.05466, S: 0 },
        "Risk Management": { R: 0.05844, S: 0 },
        "Vendor Support": { R: 0.0363, S: 0 },
        "Collaboration & Partnerships": { R: -0.10305, S: 0 }
      },
      "Quality Assurance": {
        "Regulatory Compliance": { R: -0.15634, S: 1 },
        "Industry Readiness": { R: 0.06638, S: 0 },
        "Customization Needs": { R: 0.10541, S: 0 },
        "Sustainability": { R: 0.07464, S: 0 },
        "Risk Management": { R: 0.47276, S: 1 },
        "Vendor Support": { R: -0.02996, S: 0 },
        "Collaboration & Partnerships": { R: 0.08544, S: 0 }
      },
      "Regulatory Compliance": {
        "Industry Readiness": { R: 0.07637, S: 0 },
        "Customization Needs": { R: -0.04646, S: 0 },
        "Sustainability": { R: -0.1738, S: 1 },
        "Risk Management": { R: -0.14799, S: 0 },
        "Vendor Support": { R: 0.04972, S: 0 },
        "Collaboration & Partnerships": { R: 0.12015, S: 0 }
      },
      "Industry Readiness": {
        "Customization Needs": { R: 0.00149, S: 0 },
        "Sustainability": { R: 0.14397, S: 0 },
        "Risk Management": { R: 0.53318, S: 1 },
        "Vendor Support": { R: -0.19259, S: 1 },
        "Collaboration & Partnerships": { R: -0.18637, S: 1 }
      },
      "Customization Needs": {
        "Sustainability": { R: -0.00436, S: 0 },
        "Risk Management": { R: -0.00625, S: 0 },
        "Vendor Support": { R: 0.03447, S: 0 },
        "Collaboration & Partnerships": { R: 0.06529, S: 0 }
      },
      "Sustainability": {
        "Risk Management": { R: 0.05641, S: 0 },
        "Vendor Support": { R: 0.0424, S: 0 },
        "Collaboration & Partnerships": { R: -0.0003999, S: 0 }
      },
      "Risk Management": {
        "Vendor Support": { R: 0.11034, S: 0 },
        "Collaboration & Partnerships": { R: 0.02744, S: 0 }
      },
      "Vendor Support": {
        "Collaboration & Partnerships": { R: 0.39996, S: 1 }
      }
    };


    // App state
    let appState = {
      page: 'home',
      surveyStarted: false,
      surveyFinished: false,
      currentPage: 0,
      indicatorResponses: {},
      criteriaResponses: {}
    };

    // Helper for relationships lookup
    function getPairwise(i, j) {
      const a = factors[i], b = factors[j];
      if (relationships[a] && relationships[a][b]) return relationships[a][b];
      if (relationships[b] && relationships[b][a]) return relationships[b][a];
      return { R: 0, S: 0 };
    }

    function initState() {
      appState.indicatorResponses = {};
      appState.criteriaResponses = {};
      surveyData.forEach(f => {
        appState.indicatorResponses[f.factor] = Array(f.indicators.length).fill(5);
        appState.criteriaResponses[f.factor] = Array(criteriaLabels.length).fill(5);
      });
      appState.currentPage = 0;
      appState.surveyStarted = false;
      appState.surveyFinished = false;
    }
function redoSurvey() {
  if (confirm("Are you sure you want to redo the survey? All your previous answers will be erased.")) {
    initState();
    showSurvey();
  }
}
    function setSidebarActive(page) {
      document.querySelectorAll('.sidebar ul li').forEach(li => li.classList.remove('active'));
      document.getElementById('sidebar-' + page).classList.add('active');
    }
function updateHeader() {
  // Only show title if NOT on home page
  if (appState.page === 'home') {
    document.getElementById("mainHeader").innerHTML = "";
  } else {
    document.getElementById("mainHeader").innerHTML = "Digital Spare Parts Ecosystem Decision Support Tool (DSP-DST)";
  }
}
function navigate(page) {
  setSidebarActive(page);
  appState.page = page; // Make sure this is set before updateHeader()
  updateHeader();        // <-- Add this line here
  if (page === 'home') {
        // If survey is finished, reset everything and show welcome
    if (appState.surveyFinished) {
      initState();
    }
    showWelcome();
  } else if (page === 'survey') {
    showSurvey();
  } else if (page === 'results') {
    if (appState.surveyFinished) {
      showSummary();
    } else {
      showNotFinished();
    }
  } else if (page === 'recommendations') {
    if (appState.surveyFinished) {
      showRecommendations();
    } else {
      showNotFinished();
    }
  }
}
    

    function showWelcome() {
  appState.page = 'home';
  document.getElementById("mainContent").innerHTML = `
    <div class="welcome-hero">
      <div class="hero-text">
        <h1 class="hero-title">
          Digital Spare Parts Ecosystem Decision Support Tool <span class="dspdst-acronym">(DSP-DST)</span>
        </h1>
        <div class="hero-tagline">
          Enabling data-driven adoption of digital spare parts in UAE industries
        </div>
        <div class="hero-benefit">
          <span>üîç</span> Assess your organization‚Äôs readiness for digital spare parts<br>
          <span>üöÄ</span> Unlock custom recommendations for smoother adoption<br>
        </div>
        <button class="nav-btn hero-btn" onclick="navigate('survey')">Begin My Assessment</button>
      </div>
      <div class="hero-graphic" style="display: flex; align-items: center; justify-content: center;">
        <!-- Inline SVG for reliable industry illustration -->
        <svg width="120" height="120" viewBox="0 0 64 64" aria-hidden="true">
          <g>
            <rect x="2" y="40" width="60" height="16" fill="#e2e8f0" rx="3"/>
            <rect x="6" y="20" width="20" height="20" fill="#53ccf4" rx="3"/>
            <rect x="26" y="28" width="12" height="12" fill="#1665c1" rx="2"/>
            <rect x="40" y="10" width="18" height="30" fill="#ffd966" rx="3"/>
            <circle cx="16" cy="50" r="5" fill="#fff" stroke="#53ccf4" stroke-width="2"/>
            <circle cx="48" cy="50" r="5" fill="#fff" stroke="#ffd966" stroke-width="2"/>
          </g>
        </svg>
      </div>
    </div>
    <div class="how-it-works">
      <div class="step">
        <div class="step-icon">üìù</div>
        <div class="step-title">Step 1</div>
        <div>Assess your Readiness</div>
      </div>
      <div class="step">
        <div class="step-icon">ü§ñ</div>
        <div class="step-title">Step 2</div>
        <div>Our tool analyzes your digital potential</div>
      </div>
      <div class="step">
        <div class="step-icon">üí°</div>
        <div class="step-title">Step 3</div>
        <div>Get tailored actions & recommendations</div>
      </div>
    </div>
  `;
}

    function showSurvey() {
      appState.page = 'survey';
      appState.surveyStarted = true;
      renderSurveyPage();
    }

    function renderSurveyPage() {
      const currentPage = appState.currentPage;
      const factorObj = surveyData[currentPage];
      const progressPercent = Math.round(((currentPage+1)/surveyData.length)*100);
      // Build clickable progress steps bar
let progressSteps = '';
for (let i = 0; i < surveyData.length; i++) {
    const completed = i < currentPage ? 'completed' : '';
    const current = i === currentPage ? 'current' : '';
    // Only completed steps (and current) are clickable
    progressSteps += `
      <span 
        class="progress-step ${completed} ${current}" 
        data-step="${i}"
        ${i <= currentPage ? 'tabindex="0"' : ''}
        style="margin-right: 6px;"
      >${i + 1}</span>
    `;
}
let stepsBarHTML = `<div class="progress-steps-bar" style="margin-bottom: 14px;">${progressSteps}</div>`;
let html = stepsBarHTML;
html += `<div class="progress-bar-container">
  <div class="progress-bar-bg">
    <div class="progress-bar-fill" style="width:${progressPercent}%"></div>
    <span class="progress-bar-label">Page ${currentPage+1} of 13</span>
  </div>
</div>`;
      html += `<form id="surveyForm">
        <div id="factorPage"><div class="factor-section">`;
      html += `<div class="factor-title">${factorObj.factor}</div>`;
      html += `<div style="margin-bottom:20px;"><b>Rate the following indicators (1 = Strongly Disagree, 5 = Strongly Agree):</b></div>`;
      factorObj.indicators.forEach((indicator, idx) => {
        html += `<div class="indicator-block">
          <div class="indicator-label">${indicator}</div>
          <div class="rating-group">`;
        for(let i=1; i<=5; i++) {
          const checked = (appState.indicatorResponses[factorObj.factor] && appState.indicatorResponses[factorObj.factor][idx] == i) ? "checked" : "";
          html += `<label><input type="radio" name="ind_${idx}" value="${i}" ${checked} onchange="handleIndicator(${idx},${factorObj.indicators.length})"/>${i}</label>`;
        }
        html += `</div></div>`;
      });
      html += `<div class="average-score" id="avgScore">Average: -</div>`;
      html += `<div class="weighted-score" id="weightedScore">Weighted Score: -</div>`;
      html += `<div class="strategic-action-block">
        <div class="strategic-action-title">Strategic Action</div>
        ${factorObj.strategicAction}
      </div>`;
      html += `<div style="margin-bottom:20px;"><b>Rate this strategic action against the following criteria:</b></div>`;
      criteriaLabels.forEach((label, idx) => {
        html += `<div class="criteria-block">
          <div class="criteria-label">${label}</div>
          <div class="rating-group">`;
        for(let i=1; i<=5; i++) {
          const checked = (appState.criteriaResponses[factorObj.factor] && appState.criteriaResponses[factorObj.factor][idx] == i) ? "checked" : "";
          html += `<label><input type="radio" name="crit_${idx}" value="${i}" ${checked} onchange="handleCriteria(${idx},${criteriaLabels.length})"/>${i}</label>`;
        }
        html += `</div></div>`;
      });
      html += `<div class="criteria-average" id="criteriaAvg">Criteria Average: -</div>`;
      html += `<div class="directrel-score" id="directRelScore">Direct Relationship Score: -</div>`;
      html += `</div></div>
        <div class="survey-nav">
          <button type="button" class="nav-btn" onclick="prevPage()" id="prevBtn" ${currentPage === 0 ? "disabled" : ""}>Previous</button>
          <button type="button" class="nav-btn" onclick="nextPage()" id="nextBtn">${currentPage === surveyData.length-1 ? "Finish" : "Next"}</button>
        </div>
      </form>`;
      document.getElementById("mainContent").innerHTML = html;
      updateAverages();
      updateCriteriaAverage();
      updateDirectRelScore();
    }

    function handleIndicator(idx, total) {
      const factorObj = surveyData[appState.currentPage];
      if(!appState.indicatorResponses[factorObj.factor]) appState.indicatorResponses[factorObj.factor] = Array(total).fill(5);
      const radios = document.getElementsByName(`ind_${idx}`);
      for(let radio of radios) if(radio.checked) appState.indicatorResponses[factorObj.factor][idx] = Number(radio.value);
      updateAverages();
      updateDirectRelScore();
    }
    function updateAverages() {
      const factorObj = surveyData[appState.currentPage];
      const vals = appState.indicatorResponses[factorObj.factor] || [];
      let count = 0, sum = 0;
      for(let v of vals) if(v) { sum+=v; count++; }
      const avg = (count === factorObj.indicators.length) ? (sum/count).toFixed(2) : "-";
      document.getElementById("avgScore").innerText = `Average: ${avg}`;
      let weighted = "-";
      if(avg !== "-") {
        weighted = (avg * factorObj.weight).toFixed(4);
      }
      document.getElementById("weightedScore").innerText = `Weighted Score: ${weighted}`;
    }
    function handleCriteria(idx, total) {
      const factorObj = surveyData[appState.currentPage];
      if(!appState.criteriaResponses[factorObj.factor]) appState.criteriaResponses[factorObj.factor] = Array(total).fill(5);
      const radios = document.getElementsByName(`crit_${idx}`);
      for(let radio of radios) if(radio.checked) appState.criteriaResponses[factorObj.factor][idx] = Number(radio.value);
      updateCriteriaAverage();
      updateDirectRelScore();
    }
    function updateCriteriaAverage() {
      const factorObj = surveyData[appState.currentPage];
      const vals = appState.criteriaResponses[factorObj.factor] || [];
      let count = 0, sum = 0;
      for(let v of vals) if(v) { sum+=v; count++; }
      const avg = (count === criteriaLabels.length) ? (sum/count).toFixed(2) : "-";
      document.getElementById("criteriaAvg").innerText = `Criteria Average: ${avg}`;
    }
    function updateDirectRelScore() {
      const factorObj = surveyData[appState.currentPage];
      const inds = appState.indicatorResponses[factorObj.factor] || [];
      const crits = appState.criteriaResponses[factorObj.factor] || [];
      let indAvg = null, weighted = null, critAvg = null, directRelScore = "-";
      if(inds.length === factorObj.indicators.length && inds.every(x=>!!x)) {
        indAvg = inds.reduce((a,b)=>a+b,0)/inds.length;
        weighted = indAvg * factorObj.weight;
      }
      if(crits.length === criteriaLabels.length && crits.every(x=>!!x)) {
        critAvg = crits.reduce((a,b)=>a+b,0)/crits.length;
      }
      if(weighted !== null && critAvg !== null) {
        directRelScore = (Number(weighted) * Number(critAvg)).toFixed(4);
      }
      document.getElementById("directRelScore").innerText = `Direct Relationship Score: ${directRelScore}`;
    }

    function prevPage() {
      if(appState.currentPage > 0) {
        appState.currentPage--;
        renderSurveyPage();
      }
    }
    function nextPage() {
      if(appState.currentPage < surveyData.length-1) {
        appState.currentPage++;
        renderSurveyPage();
      } else {
        appState.surveyFinished = true;
        navigate('results');
      }
    }

    // Calculation helpers for results
    function calculateUpdatedWeights() {
      return surveyData.map(factorObj => {
        const inds = appState.indicatorResponses[factorObj.factor];
        const indAvg = inds.reduce((a,b)=>a+b,0)/inds.length;
        return indAvg * factorObj.weight;
      });
    }
    function calculateIndirectImpact(updatedWeights) {
      const n = factors.length;
      const impact = {};
      for (let i = 0; i < n; i++) {
        let sum = 0;
        for (let j = 0; j < n; j++) {
          if (i === j) continue;
          const pair = getPairwise(i, j);
          let term = 0;
          if (pair.S === 1) {
            term = updatedWeights[i] * updatedWeights[j] * pair.R;
          }
          sum += term;
        }
        impact[factors[i]] = sum;
      }
      return impact;
    }

    // --- Results page with charts, table toggle, and download ---
    function showSummary() {
  appState.page = 'results';
  const updatedWeights = calculateUpdatedWeights();
  const directScores = [];
  const finalReadinessScores = [];
  const indirectImpact = calculateIndirectImpact(updatedWeights);
  const indicatorAverages = [];
  const criteriaAverages = [];
  for(let i=0; i<surveyData.length; i++) {
    const factorObj = surveyData[i];
    const inds = appState.indicatorResponses[factorObj.factor];
    const crits = appState.criteriaResponses[factorObj.factor];
    const indAvg = inds.reduce((a,b)=>a+b,0)/inds.length;
    indicatorAverages[i] = indAvg;
    const weighted = (indAvg * factorObj.weight);
    const critAvg = crits.reduce((a,b)=>a+b,0)/crits.length;
    criteriaAverages[i] = critAvg;
    directScores[i] = (weighted * critAvg);
  }
  // Final Readiness Scores array
  for(let i=0; i<surveyData.length; i++) {
    const factorObj = surveyData[i];
    const inds = appState.indicatorResponses[factorObj.factor];
    const crits = appState.criteriaResponses[factorObj.factor];
    const indAvg = inds.reduce((a,b)=>a+b,0)/inds.length;
    const updatedWeight = (indAvg * factorObj.weight).toFixed(2);
    const critAvg = crits.reduce((a,b)=>a+b,0)/crits.length;
    const directRelScore = (Number(updatedWeight) * Number(critAvg)).toFixed(4);
    const indirectRel = indirectImpact[factorObj.factor].toFixed(2);
    const finalReadiness = (parseFloat(directRelScore) + parseFloat(indirectRel));
    finalReadinessScores.push(finalReadiness);
  }
  const minFR = Math.min(...finalReadinessScores);
  const maxFR = Math.max(...finalReadinessScores);

  // Build result table html (hidden by default)
  let table = `<table class="results-table" id="resultsTable">
      <tr>
        <th>Factor</th>
        <th>Indicators Avg</th>
        <th>SEM Weight</th>
        <th>Updated Weight</th>
        <th>Strategic Action Avg</th>
        <th>Direct Relationship Score</th>
        <th>Indirect Relationship Impact</th>
        <th style="background:#e0f4ff;">Final Readiness Score</th>
        <th style="background:#eaffea;"> Readiness Score</th>
      </tr>`;
  for(let i=0; i<surveyData.length; i++) {
    const factorObj = surveyData[i];
    const inds = appState.indicatorResponses[factorObj.factor];
    const crits = appState.criteriaResponses[factorObj.factor];
    const indAvg = inds.reduce((a,b)=>a+b,0)/inds.length;
    const updatedWeight = (indAvg * factorObj.weight).toFixed(2);
    const critAvg = crits.reduce((a,b)=>a+b,0)/crits.length;
    const directRelScore = (Number(updatedWeight) * Number(critAvg)).toFixed(4);
    const indirectRel = indirectImpact[factorObj.factor].toFixed(2);
    const finalReadiness = finalReadinessScores[i];
    let pctScore = "-";
    if (maxFR !== minFR) {
      pctScore = ((finalReadiness - minFR) / (maxFR - minFR));
      pctScore = (pctScore * 100).toFixed(1) + "%";
    } else {
      pctScore = "100%";
    }
    table += `<tr>
      <td>${factorObj.factor}</td>
      <td>${indAvg.toFixed(2)}</td>
      <td>${factorObj.weight}</td>
      <td>${updatedWeight}</td>
      <td>${critAvg.toFixed(2)}</td>
      <td>${directRelScore}</td>
      <td>${indirectRel}</td>
      <td class="final-readiness-score"><b>${finalReadiness.toFixed(4)}</b></td>
      <td class="percent-score"><b>${pctScore}</b></td>
    </tr>`;
  }
  table += `</table>`;

  // Radar and bar chart containers
  let html = `<div class="results-section" id="resultsSection">
    <h2>Survey Completed</h2>
    <p>Thank you for completing the survey.<br>Here is a summary of your responses.</p>
    <div class="chart-toggle-group">
      <button class="chart-toggle-btn selected" id="radarToggle" onclick="toggleChart('radar')">Radar Chart</button>
      <button class="chart-toggle-btn" id="barToggle" onclick="toggleChart('bar')">Bar Chart</button>
    </div>
    <div class="chart-wrapper" id="radarChartWrapper" style="max-width:900px;">
      <canvas id="radarChart"></canvas>
    </div>
    <div class="bar-chart-wrapper" id="barChartWrapper" style="display:none;">
      <canvas id="barChart"></canvas>
    </div>
    <div style="margin:13px 0 16px 0;">
      <button class="toggle-table-btn" onclick="toggleResultTable()">Show/Hide Results Table</button>
      <button class="toggle-table-btn" onclick="downloadTableCSV()">Download Table (CSV)</button>
      <button class="toggle-table-btn" style="background:#fceaea;color:#b40000;border-color:#b40000;" onclick="redoSurvey()">&#x21bb; Redo Survey</button>
    </div>
    <div class="results-table-wrapper">${table}</div>
  </div>`;

  document.getElementById("mainContent").innerHTML = html;
  setTimeout(() => drawCharts(finalReadinessScores), 40);
}
    // --- Recommendations Page
function showRecommendations() {
  // Calculate percent scores as before
  const updatedWeights = calculateUpdatedWeights();
  const indirectImpact = calculateIndirectImpact(updatedWeights);
  const finalReadinessScores = [];
  for (let i = 0; i < surveyData.length; i++) {
    const factorObj = surveyData[i];
    const inds = appState.indicatorResponses[factorObj.factor];
    const crits = appState.criteriaResponses[factorObj.factor];
    const indAvg = inds.reduce((a, b) => a + b, 0) / inds.length;
    const updatedWeight = (indAvg * factorObj.weight).toFixed(2);
    const critAvg = crits.reduce((a, b) => a + b, 0) / crits.length;
    const directRelScore = (Number(updatedWeight) * Number(critAvg)).toFixed(4);
    const indirectRel = indirectImpact[factorObj.factor].toFixed(2);
    const finalReadiness = (parseFloat(directRelScore) + parseFloat(indirectRel));
    finalReadinessScores.push(finalReadiness);
  }
  const minFR = Math.min(...finalReadinessScores);
  const maxFR = Math.max(...finalReadinessScores);
  const percentScores = finalReadinessScores.map(x =>
    maxFR !== minFR ? ((x - minFR) / (maxFR - minFR)) * 100 : 100
  );

  function getBadgeClass(score) {
    if (score <= 50) return "low";
    if (score <= 75) return "medium";
    return "high";
  }

  // Helper for recommendations cards
  const prettyCards = (arr, color, type) =>
    arr.map((x, idx) => `
      <div class="rec-card rec-${type}" style="border-left-color:${color};">
        <span class="rec-step" style="background:${color};">${idx + 1}</span>
        <span>${x}</span>
      </div>
    `).join("");

  let html = `<div class="results-section" id="recommendationsSection">
    <h2 style="margin-bottom:18px;">DSP Recommendations by Factor</h2>
    <div style="font-size:1.10em; margin-bottom:22px;">
      Recommendations below are tailored to your <b>readiness score</b> for each factor.
    </div>
    <div style="margin-top:28px;">`;

  html += factors.map((fac, i) => {
    const plan = ecosystemPlan[fac] || {};
    const score = percentScores[i];
    let scoreStr = (score !== undefined && !isNaN(score)) ? score.toFixed(1) + "%" : "-";
    let badgeClass = getBadgeClass(score);

    // Compose recommendations section
    let rec = "";

    if (score <= 50) {
      if (plan.shortTerm) {
        rec += `<div class="rec-title" style="color:#2477d6;">&#128640; Short-Term Sub-Actions</div>
          ${prettyCards(plan.shortTerm, "#2477d6", "short")}`;
      }
      if (plan.acceleration) {
        rec += `<div class="rec-title" style="color:#e6841b;">&#9889; Acceleration Mechanism</div>
          ${prettyCards(plan.acceleration, "#e6841b", "accl")}`;
      }
    } else if (score > 50 && score <= 75) {
      if (plan.shortTerm) {
        rec += `<div class="rec-title" style="color:#2477d6;">&#128640; Short-Term Sub-Actions</div>
          ${prettyCards(plan.shortTerm, "#2477d6", "short")}`;
      }
      if (plan.longTerm) {
        rec += `<div class="rec-title" style="color:#21a179;">&#128187; Long-Term Sub-Actions</div>
          ${prettyCards(plan.longTerm, "#21a179", "long")}`;
      }
      if (plan.acceleration) {
        rec += `<div class="rec-title" style="color:#e6841b;">&#9889; Acceleration Mechanism</div>
          ${prettyCards(plan.acceleration, "#e6841b", "accl")}`;
      }
    } else {
      if (plan.longTerm) {
        rec += `<div class="rec-title" style="color:#21a179;">&#128187; Long-Term Sub-Actions</div>
          ${prettyCards(plan.longTerm, "#21a179", "long")}`;
      }
      if (plan.acceleration) {
        rec += `<details class="rec-card rec-accl">
          <summary>&#9889; Acceleration Mechanism (Optional, click to expand)</summary>
          ${prettyCards(plan.acceleration, "#e6841b", "accl")}
        </details>`;
      }
    }

    return `
      <div style="margin-bottom:36px;">
        <div class="factor-score-row">
          <span class="factor-score-label">${fac}</span>
          <span class="factor-score-badge ${badgeClass}">${scoreStr}</span>
        </div>
        <div>
          ${rec || '<div style="color:#888;font-size:0.96em;">No recommendations available for this factor.</div>'}
        </div>
      </div>
    `;
  }).join("");

  html += `</div>
    <div style="text-align:right; margin: 18px 0 8px 0;">
      <button class="toggle-table-btn"
              style="background:#fceaea;color:#b40000;border-color:#b40000;"
              onclick="redoSurvey()">&#x21bb; Redo Survey</button>
    </div>
  </div>`;

  document.getElementById("mainContent").innerHTML = html;
}

    function drawCharts(finalReadinessScores) {
      // Radar Chart - Final Readiness Score (scaled 0-5 for radar)
      const radarMax = Math.max(...finalReadinessScores);
      const radarMin = Math.min(...finalReadinessScores);
      const radarData = finalReadinessScores.map(x =>
        radarMax !== radarMin ? ((x - radarMin)/(radarMax-radarMin))*5 : 5
      );
      if(window.radarChartObj) window.radarChartObj.destroy();
      window.radarChartObj = new Chart(document.getElementById('radarChart'), {
        type: 'radar',
        data: {
          labels: factors,
          datasets: [{
            label: "Final Readiness ",
            data: radarData,
            fill: false,
            backgroundColor: "rgba(0,0,0,0)",
            borderColor: "#0099cc",
            pointBackgroundColor: "#0099cc",
            pointBorderColor: "#fff",
            pointHoverBackgroundColor: "#fff",
            pointHoverBorderColor: "#0099cc"
          }]
        },
        options: {
          responsive: false,
          plugins: { legend: {display: false}},
          scales: {
            r: {
              beginAtZero:true,
              min:0,
              max:5,
              ticks: { stepSize: 1, color:"#222" },
              pointLabels: { font: { size: 13, weight: "bold" }, color: "#31415a" }
            }
          }
        }
      });

      // Bar Chart - Readiness Score per factor
      const minFR = Math.min(...finalReadinessScores);
      const maxFR = Math.max(...finalReadinessScores);
      const pctData = finalReadinessScores.map(x =>
        maxFR !== minFR ? ((x - minFR)/(maxFR-minFR))*100 : 100
      );
      if(window.barChartObj) window.barChartObj.destroy();
      window.barChartObj = new Chart(document.getElementById('barChart'), {
        type: 'bar',
        data: {
          labels: factors,
          datasets: [{
            label: "Readiness Score",
            data: pctData,
            backgroundColor: "rgba(67,198,228,0.7)",
            borderColor: "#0099cc",
            borderWidth: 1,
            hoverBackgroundColor: "#0099cc"
          }]
        },
        options: {
          indexAxis: 'y',
          responsive: true,
          plugins: { legend: {display: false}},
          scales: {
            x: {
              min: 0,
              max: 100,
              ticks: { color: "#222", callback: v=>v+"%" },
              grid: { color: "#e0f4ff"}
            },
            y: {
              ticks: { color: "#31415a", font: {weight:600}},
              grid: { color: "#e0f4ff"}
            }
          }
        }
      });
    }

    function downloadResults() {
      const updatedWeights = calculateUpdatedWeights();
      const indirectImpact = calculateIndirectImpact(updatedWeights);
      const results = [];
      const finalReadinessScores = [];
      for(let i=0; i<surveyData.length; i++) {
        const factorObj = surveyData[i];
        const inds = appState.indicatorResponses[factorObj.factor];
        const crits = appState.criteriaResponses[factorObj.factor];
        const indAvg = inds.reduce((a,b)=>a+b,0)/inds.length;
        const updatedWeight = (indAvg * factorObj.weight).toFixed(2);
        const critAvg = crits.reduce((a,b)=>a+b,0)/crits.length;
        const directRelScore = (Number(updatedWeight) * Number(critAvg)).toFixed(4);
        const indirectRel = indirectImpact[factorObj.factor].toFixed(2);
        const finalReadiness = (parseFloat(directRelScore) + parseFloat(indirectRel));
        finalReadinessScores.push(finalReadiness);
      }
      const minFR = Math.min(...finalReadinessScores);
      const maxFR = Math.max(...finalReadinessScores);

      for(let i=0; i<surveyData.length; i++) {
        const factorObj = surveyData[i];
        const inds = appState.indicatorResponses[factorObj.factor];
        const crits = appState.criteriaResponses[factorObj.factor];
        const indAvg = inds.reduce((a,b)=>a+b,0)/inds.length;
        const updatedWeight = (indAvg * factorObj.weight).toFixed(2);
        const critAvg = crits.reduce((a,b)=>a+b,0)/crits.length;
        const directRelScore = (Number(updatedWeight) * Number(critAvg)).toFixed(4);
        const indirectRel = indirectImpact[factorObj.factor].toFixed(2);
        const finalReadiness = finalReadinessScores[i];
        let pctScore = "-";
        if (maxFR !== minFR) {
          pctScore = ((finalReadiness - minFR) / (maxFR - minFR));
          pctScore = (pctScore * 100).toFixed(1) + "%";
        } else {
          pctScore = "100%";
        }
        results.push({
          factor: factorObj.factor,
          indicatorResponses: inds,
          indicatorAverage: indAvg.toFixed(2),
          semWeight: factorObj.weight,
          updatedWeight: updatedWeight,
          strategicAction: factorObj.strategicAction,
          criteriaResponses: crits,
          criteriaAverage: critAvg.toFixed(2),
          directRelationshipScore: directRelScore,
          indirectRelationshipImpact: indirectRel,
          finalReadinessScore: finalReadiness.toFixed(4),
          percentScore: pctScore
        });
      }
      const blob = new Blob([JSON.stringify(results, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'dsp_survey_results.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    function downloadTableCSV() {
      const table = document.getElementById('resultsTable');
      let csv = '';
      if (!table) return;
      for (let r = 0; r < table.rows.length; r++) {
        let row = [];
        for (let c = 0; c < table.rows[r].cells.length; c++) {
          let val = table.rows[r].cells[c].innerText.replace(/"/g, '""');
          row.push('"' + val + '"');
        }
        csv += row.join(',') + '\n';
      }
      const blob = new Blob([csv], {type: 'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'dsp_survey_results.csv';
      a.click();
      URL.revokeObjectURL(url);
    }

    function toggleResultTable() {
      const table = document.getElementById('resultsTable');
      if (!table) return;
      table.classList.toggle('visible');
    }
     function toggleChart(type) {
  const radarBtn = document.getElementById('radarToggle');
  const barBtn = document.getElementById('barToggle');
  const radarWrap = document.getElementById('radarChartWrapper');
  const barWrap = document.getElementById('barChartWrapper');
  if (type === 'radar') {
    radarBtn.classList.add('selected');
    barBtn.classList.remove('selected');
    radarWrap.style.display = '';
    barWrap.style.display = 'none';
  } else {
    barBtn.classList.add('selected');
    radarBtn.classList.remove('selected');
    barWrap.style.display = '';
    radarWrap.style.display = 'none';
  }
}

    function showNotFinished() {
      document.getElementById("mainContent").innerHTML = `
        <div class="factor-section" style="text-align:center;">
          <h2>Survey Not Completed</h2>
          <p>Please complete the survey before viewing results.</p>
          <div style="margin-top:24px;">
            <button class="nav-btn" onclick="navigate('survey')">Continue Survey</button>
          </div>
        </div>
      `;
    }

    function showSettings() {
      appState.page = 'settings';
      document.getElementById("mainContent").innerHTML = `
        <div class="settings-section">
          <h2>Settings</h2>
          <p>Settings feature coming soon.</p>
        </div>
      `;
    }

window.onload = function() {
  initState();
  showWelcome();
  updateHeader(); 
};

document.addEventListener('click', function(e) {
  if (e.target.classList.contains('progress-step') && e.target.classList.contains('completed')) {
    const step = parseInt(e.target.dataset.step, 10);
    if (!isNaN(step)) {
      appState.currentPage = step;
      renderSurveyPage();
    }
  }
});
  </script>
</body>
</html>